<h1>Edit Device #{{ vm.prevState.id }}</h1>

<form name="deviceForm" ng-submit="vm.submitForm()" novalidate role="form">

  <div class="form-group" show-form-errors>
    <label class="control-label">ID</label>
    <input
      type="number"
      name="id"
      class="form-control"
      required
      min="1"
      max="255"
      ng-model="vm.device.id"
      tooltip="Device Unique ID (like address) between 1 and 255"
      tooltip-placement="right">
  </div>

  <div class="form-group" show-form-errors>
    <label class="control-label">Name</label>
    <input
      type="text"
      name="name"
      class="form-control"
      placeholder="Enter device name"
      required
      ng-model="vm.device.name"
      ng-pattern="/^[a-z0-9\_\- ]+$/i"
      tooltip="Examples: My first device, Kitchen node, Wireless board (allowed chars: [a-z0-9_- ])"
      tooltip-placement="right">
  </div>

  <div class="form-group" show-form-errors>
    <label class="control-label">Connection URI</label>
    <input
      type="text"
      name="netrouter"
      class="form-control"
      placeholder="How device will be connected to SmartAnthill?"
      required
      ng-model="vm.device.connectionUri"
      ng-pattern="/^serial\:\/\/[^\?]+(\?(\&?[a-z]+=[^\:]+)+)?$/"
      tooltip="Examples: serial:///dev/ttyUSB0, serial://COM1?baudrate=9600"
      tooltip-placement="right">
  </div>

  <div class="form-group" ng-class="{'has-success': vm.selectBoard.selected}" show-form-errors="vm.submitted && !vm.selectBoard.selected">
    <label class="control-label">Board</label>
    <ui-select ng-model="vm.selectBoard.selected" theme="bootstrap" ng-disabled="vm.device.bodyparts.length">
      <ui-select-match required placeholder="Select or search a board in the list...">{{$select.selected.name}}</ui-select-match>
      <ui-select-choices group-by="vm.boardGroupBy" repeat="item in vm.boards | filter: {name: $select.search}">
        <div ng-bind-html="item.name | highlight: $select.search"></div>
      </ui-select-choices>
    </ui-select>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">
        Body Parts
        <button ng-if="vm.device.bodyparts.length" type="button" class="btn btn-success btn-xs" ng-click="vm.bodyPartModal()"><i class="fa fa-plus"></i> Add</button>
      </h3>
    </div>

    <div class="panel-body">
      <button ng-if="!vm.device.bodyparts.length" ng-class="{disabled: !vm.selectBoard.selected}" type="button" class="btn btn-success" ng-click="vm.bodyPartModal()"><i class="fa fa-plus"></i> Add Body Part</button>
      <div class="form-group" ng-class="{'has-success': vm.device.bodyparts.length}" ng-if="vm.device.bodyparts.length">
        <table id="bodyparts-table" class="table table-hover" ng-show="vm.device.bodyparts">
          <thead>
            <tr>
              <th>Name</th>
              <th>Plugin</th>
              <th>Options</th>
              <th>Peripheral</th>
              <th class="modify">Modify</th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="item in vm.device.bodyparts">
              <td>{{ item.name }}</td>
              <td>{{ item.pluginId | idToName : vm.idToNameMap }}</td>
              <td>
                <dl ng-repeat="(key, value) in item.options">
                  <dt>{{ key | idToName : vm.idToNameMap : item.pluginId }}</dt><dd>{{ value }}</dd>
                </dl>
              </td>
              <td>
                <dl ng-repeat="(key, value) in item.peripheral">
                  <dt>{{ key | idToName : vm.idToNameMap : item.pluginId }}</dt><dd>{{ value }}</dd>
                </dl>
              </td>
              <td class="modify">
                <i class="fa fa-pencil-square-o fa-lg" style="cursor: pointer" ng-click="vm.bodyPartModal($index)" tooltip="Edit"></i>
                <i class="fa fa-times fa-lg" style="cursor: pointer" ng-click="vm.removeBodyPart($index)" tooltip="Remove"></i>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="form-group" show-form-errors>
    <label class="control-label">Device is enabled</label>
    <div class="btn-group">
      <label class="btn btn-default" ng-model="vm.device.enabled" btn-radio="true">Yes</label>
      <label class="btn btn-default" ng-model="vm.device.enabled" btn-radio="false">No</label>
    </div>
  </div>

  <button type="submit" class="btn btn-primary" ng-disabled="vm.disableSubmit || deviceForm.$invalid || !vm.selectBoard.selected || !vm.device.bodyparts.length">Submit</button>
  <button type="button" class="btn btn-link" ng-click="vm.resetForm()">Reset</button>
</form>

<br class=clearfix>
